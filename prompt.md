–ü—Ä–∏–≤—ñ—Ç. –•–æ—á –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∑–∞–ø–∏—Ç –±—É–¥–µ –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é, –∞–ª–µ —Ç–∏ –º–æ–∂–µ—à —Å–ø—ñ–ª–∫—É–≤–∞—Ç–∏—Å—è –∑—ñ –º–Ω–æ—é —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é. –†–∞–Ω—ñ—à–µ (–¥–∞–≤–Ω–æ, –±—ñ–ª—å—à–µ —Ä–æ–∫—É —Ç–æ–º—É) —è –ø–∏—Å–∞–≤ –ø—Ä–æ–º–ø—Ç –≤ –∫–ª–æ–¥ –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è LSP –¥–ª—è PHP:
```
Hi! I‚Äôm working on creating a custom Language Server Protocol (LSP) server for PHP, and I want to implement it in Rust. Ideally, I‚Äôd like to use the [`async-lsp`](https://docs.rs/async-lsp/latest/async_lsp/) crate instead of `tower-lsp`, as I‚Äôm more excited about its architecture and async-native design. ### üß† Motivation To be honest, one of my main motivations is that I‚Äôve long dreamed of writing an LSP server in Rust using modern async tools. I‚Äôm also not satisfied with the current state of PHP support in existing tools. I‚Äôve used [Intelephense](https://intelephense.com/) extensively ‚Äî while it‚Äôs quite powerful and feature-rich, it often feels heavy, opaque, and hard to extend or debug. Similarly, JetBrains IDEs, although popular, tend to be resource-intensive and somewhat rigid for modern PHP workflows. What I really want is something lightweight, modular, and hackable ‚Äî a language server that‚Äôs truly optimized for my workflow and that I fully control. That‚Äôs what pushed me toward building a custom solution from scratch. ### üß± LSP Server Requirements - The server should support basic LSP features: initialization, diagnostics, completions, hover, go-to-definition. - I want to use `tree-sitter-php` for PHP syntax parsing. - The server should analyze open documents and provide diagnostics (e.g., detect TODOs). - Full support for async handling using `tokio`. ### üíª Technical Goals - Use `async-lsp` and Rust for the implementation. - Architect it cleanly with a router-style handler setup. - Add snippet completions, variable completions, hover messages, and symbol extraction. - Possibly support workspace-wide features like document symbols and go-to-definition. ### üß™ Editor Integration I also want to integrate this LSP server with the [Zed.dev](https://zed.dev) code editor. So far, I understand that: - Zed is written in Rust and supports LSPs through a language extension system. - Extensions are configured with TOML files and placed in `~/.config/zed/extensions/`. - There‚Äôs a way to link an LSP executable to a language (like PHP) by specifying `language_server.command`. But I‚Äôd like more clarity on this: - Is there an official or recommended way to integrate *custom* LSP servers with Zed? - Are there any Zed APIs or native Rust crates I can use to build LSPs or language extensions directly for Zed? - Does Zed provide any richer language service integration beyond the standard LSP (e.g., internal APIs or plugin hooks)? ### üåê What I‚Äôd Appreciate Help With - Step-by-step instructions or links on integrating my Rust-based async-lsp server into Zed - Code examples for both the server and the Zed extension (if available) - Any guidance on best practices or community-supported approaches Thanks so much!
```
–Ø —Ç–∞–∫ —ñ –Ω–µ –∑–∞–≤–µ—Ä—à–∏–≤ —Ü–µ–π –ø—Ä–æ–µ–∫—Ç, –ø—Ä–æ—Ç–µ –∑–∞—Ä–∞–∑ –≤ –º–µ–Ω–µ –≤–∏–Ω–∏–∫–ª–∞ —Ä–µ–∞–ª—å–Ω–∞ –ø–æ—Ç—Ä–µ–±–∞ –≤ –∫–∞—Å—Ç–æ–º–Ω–æ–º—É LSP –¥–ª—è Zed —ñ —Ü–µ —â–æ–Ω–∞–π–º–µ–Ω—à–µ –º–æ–∂–µ –º–µ–Ω—ñ –∑–±–µ—Ä–µ–≥—Ç–∏ –∫—É–ø—É –≥—Ä–æ—à–µ–π –Ω–∞ –ª—ñ—Ü–µ–Ω–∑—ñ—é –¥–ª—è PhpStorm –∞–±–æ –Ω–∞ —Ç–æ–π –∂–µ Intelephense. –ó–∞—Ä–∞–∑ —Ç–∏ –≤–∂–µ —Å—Ç–∞–≤ —Ä–æ–∑—É–º–Ω—ñ—à–∏–π:) —ñ –∑—è–≤–∏–ª–æ—Å—è –¥–æ—Å–∏—Ç—å –±–∞–≥–∞—Ç–æ —É—Ç–∏–ª—ñ—Ç —Ç–∞ –¥–æ–ø–æ–º—ñ–∂–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ–π —Ç–æ—â–æ, –æ—Å–æ–±–ª–∏–≤–æ –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ https://github.com/github/spec-kit —Ç–∞ –π–æ–≥–æ —Ñ–æ—Ä–∫ https://github.com/panaversity/spec-kit-plus (—è–∫–∏–π —è —ñ —Ö–æ—Ç—ñ–≤ –±–∏ –ø–æ—Ç–µ—Å—Ç–∏—Ç–∏).

–¢–∞–∫ –æ—Ç –≤ —Ü—ñ–ª–æ–º—É –≥–æ–ª–æ–≤–Ω–∞ —Ü—ñ–ª—å —î –≤—ñ–¥–Ω–æ—Å–Ω–æ –ø—Ä–æ—Å—Ç–∞ - –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ —è —Ö–æ—á—É —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ä–µ–∞–ª—å–Ω–æ –ø–æ–≤–Ω–æ—Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π LSP –¥–ª—è PHP. 

–ü—Ä–æ—Ç–µ –æ—Å–æ–±–ª–∏–≤—ñ—Å—Ç—å –≤ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É:
* LSP —è —Ö–æ—á—É –Ω–∞–ø–∏—Å–∞—Ç–∏ –Ω–∞ rust –∑ async-lsp (–æ—Å—å –≥—ñ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π https://github.com/oxalica/async-lsp, —ñ –æ—Å—å —â–µ https://docs.rs/async-lsp/latest/async_lsp/).
* —Ç–∞–∫–æ–∂ —è —Ö–æ—á—É —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ spec-kit-plus —â–æ–± —â–æ–Ω–∞–π–º–µ–Ω—à–µ —ñ—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—ñ —Ñ—ñ—á—ñ –¥–æ —Å–≤–æ–≥–æ LSP –Ω—É —ñ –≤ —Ü—ñ–ª–æ–º—É —Ä–æ–∑—Ä–æ–±–∏—Ç–∏ –π–æ–≥–æ

–¢–æ–º—É —è —Ö–æ—á—É —â–æ–± —Ç–∏ –º–µ–Ω—ñ —â–æ–Ω–∞–π–º–µ–Ω—à–µ –¥–æ–ø–æ–º—ñ–≥ –∑ –Ω–∞–ø–∏—Å–∞–Ω–Ω—è–º –ø—Ä–æ–º–ø—Ç—ñ–≤ –¥–ª—è –∫–ª–æ–¥ –∫–æ–¥ –∞–ª–µ –∑ –ø—ñ–¥—Ö–æ–¥–æ–º Specification-Driven Development (SDD). –ó–≤–∞–∂ —Ç–∞–∫–æ–∂ –Ω–∞ —Ç–µ —è–∫–∞ —Å—å–æ–≥–æ–¥–Ω—ñ –¥–∞—Ç–∞ —â–æ–± —à—É–∫–∞—Ç–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –º–æ–∂–ª–∏–≤–æ –æ—Å—Ç–∞–Ω–Ω—ñ –≤–µ—Ä—Å—ñ—ó –ø–∞–∫–µ—Ç—ñ–≤ —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ.

–í —Ü—ñ–ª–æ–º—É —è –ø–æ—á–∏–Ω–∞—é –ø–æ–≤–Ω—ñ—Å—Ç—é –∑ –Ω—É–ª—è, –ø—Ä–æ—Ç–µ —è –≤–∂–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞–≤ –ø—Ä–æ–µ–∫—Ç:
```
[package]
name = "php-lsp"
version = "0.1.0"
edition = "2024"

[dependencies]
async-lsp = "0.2.2"
tree-sitter = "0.25.10"
tree-sitter-php = "0.24.2"
```

–ù–∞—Ä–∞–∑—ñ –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø–æ–º–∏–ª–æ–∫ –≤ PHP –∫–æ–¥—ñ –¥–ª—è Zed —è –≤–∂–µ –º–∞—é —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—é –∑ phpmd —Ç–∞ psalm, —Ü—å–æ–≥–æ +- –¥–æ—Å—Ç–∞—Ç–Ω—å–æ, –∞–ª–µ –≤ –ø–æ–¥–∞–ª—å—à–æ–º—É —è –≤—Å–µ –∂ —Ö–æ—Ç—ñ–≤ –±–∏ –¥–æ–¥–∞—Ç–∏ –ø–æ–∫—Ä–∞—â–µ–Ω—É –ø—ñ–¥—Ç—Ä–∏–º–∫—É –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏. –î–µ—â–æ –ø—Ä–æ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É –≤ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –ø—É–Ω–∫—Ç—ñ. –ó–∞ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –∫–æ–¥—É –∑–¥–µ–±—ñ–ª—å—à–æ–≥–æ –≤ –º–æ—ó—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å —Ä—ñ–∑–Ω—ñ —É—Ç–∏–ª—ñ—Ç–∏, —è–∫ –æ—Ç php-cs-fixer, rector —Ç–∞ —ñ–Ω—à—ñ, —Ç–æ–º—É –Ω–∞—Ä–∞–∑—ñ —Ü–µ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –ø—Ä–æ—Ç–µ –∑–≤—ñ—Å–Ω–æ –≤ –ø–æ–¥–∞–ª—å—à–æ–º—É —è —Ö–æ—á—É —Ü–µ –¥–æ–¥–∞—Ç–∏ –≤ —Ü–µ–π LSP. –°—Ç–æ—Å–æ–≤–Ω–æ —ñ–Ω—à–∏—Ö - —è —Ö–æ—á—É –≤—Å–µ:) –ó—Ä–æ–∑—É–º—ñ–π, —è —Ä–æ–∫–∞–º–∏ –ø—Ä–∞—Ü—é–≤–∞–≤ –∑ PHPStorm, –≤–µ—Å—å —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –π–æ–≥–æ –≤–±—É–¥–æ–≤–∞–Ω–æ–≥–æ LSP –º–µ–Ω–µ –ø–æ–≤–Ω—ñ—Å—Ç—é –∑–∞–¥–æ–≤–æ–ª—å–Ω—è–≤, —Ç–æ–º—É –≤–∏–æ–∫—Ä–µ–º–∏—Ç–∏ —â–æ—Å—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –Ω–µ –º–æ–∂—É. 100% —Ü–µ–π LSP –º–∞—î –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ PHPDOC –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ —Ç–∞ —ó—Ö –ø–∞—Ä—Å–∏–Ω–≥ —â–æ–Ω–∞–π–º–µ–Ω—à–µ –¥–ª—è phpstan, psalm —Ç–∞ —ñ–Ω—à–∏–º–∏ —É—Ç–∏–ª—ñ—Ç–∞–º–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ (—Ö–æ—á —è —ñ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é –¥–æ–∫—Ç—Ä–∏–Ω—É –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –±–∞–∑–æ—é, —Ö–æ—á–∞ —Ö—Ç–æ –∑–Ω–∞ —è–∫ –±—É–¥–µ –¥–∞–ª—ñ) –¥–æ–∫—Ç—Ä–∏–Ω—É, –ø–æ—Ç—Ä—ñ–±–Ω–æ —â–æ–± –¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è –∫–æ–¥—É —Ç–∞–π –∑–∞–≥–∞–ª–æ–º –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞ —Ç–∞–∫–æ–∂ –≤—Ä–∞—Ö–æ–≤—É–≤–∞–ª–æ phpdoc –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ. –Ø –¥—É–º–∞—é —â–æ –Ω–∞ –ø–æ—á–∞—Ç–∫—É —Ç—É—Ç –º–∞—î –±—É—Ç–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ –≤—Å—ñ—Ö —Ñ—ñ—á PHP 8+. –ê–ª–µ:) –ù–∞–ø—Ä–∏–∫–ª–∞–¥ –≤ PHPStorm –∑—Ä–æ–±–ª–µ–Ω–æ –≤—Å–µ —Ç–∞–∫, —â–æ —è–∫—â–æ –≤ –ø—Ä–æ–µ–∫—Ç—ñ —î composer.json —ñ —Ç–∞–º –∑–∞–∑–Ω–∞—á–µ–Ω–∞ —è–∫–∞—Å—å –≤–µ—Ä—Å—ñ—è php, —Ç–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –≤—ñ–Ω –∞–¥–∞–ø—Ç—É—î –¥–æ–ø–æ—Å–Ω–µ–Ω–Ω—è –∫–æ–¥—É —Ç–∞ –≤—Å—é –º–æ–∂–ª–∏–≤—É –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É —Å–∞–º–µ –¥–ª—è —Ü—ñ—î—ó –≤–µ—Ä—Å—ñ—ó. –¢–µ–∂ –¥–æ—Å–∏—Ç—å –≤–∞–∂–ª–∏–≤–æ - —è–∫—â–æ —è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª —è–∫–æ–≥–æ—Å—å —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è, —ñ –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–æ–Ω–æ –≤ –º–µ–Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ —Å–∏—Å—Ç–µ–º—ñ –∞–ª–µ –Ω–µ –∑–∞–∑–Ω–∞—á–µ–Ω–æ –≤ composer.json —Ç–æ —è —Ö–æ—á—É –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ —Ü–µ —â–æ–± –¥–æ–¥–∞—Ç–∏ –≤ composer.json. –í —Ü—ñ–ª–æ–º—É –±—É–¥–µ –Ω–µ –ø–æ–≥–∞–Ω–æ —â–æ–± —Ü–µ–π LSP –º–∞–≤ –ø—ñ–¥—Ç—Ä–∏–º–∫—É —Ä—ñ–∑–Ω–∏—Ö –≤–µ—Ä—Å—ñ–π PHP –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é –≤–∫–∞–∑–∞—Ç–∏ –∫–æ–Ω—Ä–µ—Ç–Ω–∏–π –±—ñ–Ω–∞—Ä–Ω–∏–∫ –∑ –ø–æ—Ç—Ä—ñ–±–Ω–æ—é –≤–µ—Ä—Å—ñ—î—é. –©–æ–¥–æ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫—ñ–≤? –ù–∞—Ä–∞–∑—ñ –º–µ–Ω—ñ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–æ –¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è –∫–æ–¥—É —Å–∞–º–µ –¥–ª—è WordPress. –û—Å—å –¥–æ –ø—Ä–∏–∫–ª–∞–¥—É —î –≤—ñ–¥–æ–º–∏–π LSP –¥–ª—è PHP https://github.com/phpactor/phpactor, –≤—ñ–Ω –Ω–µ –º–∞—î —è–∫–æ–≥–æ—Å—å —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–æ –æ—Ä—ñ—î–Ω—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ —è–∫–∏–π—Å—å —Ñ—Ä–µ–π–º–≤–æ—Ä–∫, —Ç–æ–º—É –ø–æ-—Å—É—Ç—ñ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –º–∞–π–∂–µ –≤—Å—å–æ–≥–æ, —Ç–æ–º—É —â–æ –≤—ñ–Ω –≤–ª–∞—Å–Ω–µ —ñ –Ω–∞–¥–∞—î —â–æ–Ω–∞–π–º–µ–Ω—à–µ –ø—ñ–¥—Å–≤—ñ—Ç–∫—É —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É —Ç–∞ –≤—Å–µ —ñ–Ω—à–µ. –ê–ª–µ –Ω–∞–π–±—ñ–ª—å—à–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∑ WordPress –∑ –∞–≤—Ç–æ–¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è–º –∫–æ–¥—É –¥–ª—è —Å–∏—Å—Ç–µ–º–∏ —Ö—É–∫—ñ–≤, –≤—Å—ñ —ñ—Å–Ω—É—é—á—ñ LSP –±–∞—á–∞—Ç—å –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ —Ñ—É–Ω–∫—Ü—ñ—ó add_action —è–∫ —Ñ—É–Ω–∫—Ü—ñ—é —è–∫–∞ –ø—Ä–∏–π–º–∞—î —è–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–≤—ñ —Å—Ç—Ä–æ–∫–∏ - —Å–∞–º –µ–∫—à–Ω —Ç–∞ –º–æ–∂–ª–∏–≤–æ –Ω–∞–∑–≤—É —Ñ—É–Ω–∫—Ü—ñ—ó. –ê–ª–µ –∫–ª—ñ–∫–Ω—É–≤—à–∏ –Ω–∞ –Ω–∞–∑–≤—É —Ñ—É–Ω–∫—Ü—ñ—ó –ø–µ—Ä–µ–π—Ç–∏ –Ω–µ –º–æ–∂–ª–∏–≤–æ —è–∫ —ñ –∫–ª—ñ–∫–Ω—É–≤—à–∏ –Ω–∞ –Ω–∞–∑–≤—É —Å–∞–º–æ–≥–æ —Ö—É–∫—É —á–∏ —Ñ—ñ–ª—å—Ç—Ä–∞ —â–æ–± –ø–µ—Ä–µ–π—Ç–∏ —Å–∫–∞–∂—ñ–º–æ –≤ –º—ñ—Å—Ü–µ –¥–µ –≤–æ–Ω–∏ –±—É–ª–∏ –æ–±—è–≤–ª–µ–Ω—ñ. –î–æ —Ç–æ–≥–æ –∂ –≤ WordPress –º–æ–∂–Ω–∞ –∂ –¥–æ–¥–∞–≤–∞—Ç–∏ –∫–∞—Å—Ç–æ–º–Ω—ñ —Ö—É–∫–∏ –≤ —Ä—ñ–∑–Ω–∏—Ö –ø–ª–∞–≥—ñ–Ω–∞—Ö —ñ –ø–æ —Ü–∏—Ö —Ö—É–∫–∞—Ö –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–∏ (—Ç–æ–±—Ç–æ go-to-definition). –¢—ñ–ª—å–∫–∏ PHPStorm –∞–¥–µ–∫–≤–∞—Ç–Ω–æ –≤–∏—Ä—ñ—à—É—î —Ü—ñ –ø—Ä–æ–±–ª–µ–º–∏, Intelephense –º–∞—î —Ü—é —Ñ—É–Ω–∫—Ü—ñ—é –∞–ª–µ –≤–æ–Ω–∞ –∑–æ–≤—Å—ñ–º –Ω–µ —ñ–¥–µ–∞–ª—å–Ω–∞ —ñ –ø—Ä–∞—Ü—é—î –Ω–µ —Ç–∞–∫ —è–∫ —Ü–µ –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ –≤ —Ç–æ–º—É –∂ PHPStorm, phpactor –∑–æ–≤—Å—ñ–º –Ω–∞–≤—ñ—Ç—å –Ω–µ –¥—É–º–∞—î —Ü–µ –∑–∞–ø—Ä–æ–≤–∞–¥–∂—É–≤–∞—Ç–∏ —Å—É–¥—è—á–∏ –∑ —ó—Ö –±–∞–≥—Ç—Ä–µ–∫–µ—Ä–∞.

–î–æ—Ä–µ—á—ñ –æ—Å—å —â–µ –∑–Ω–∞–π—à–æ–≤ —Ü—ñ–∫–∞–≤–∏–π –ø—Ä–æ–µ–∫—Ç –≤ –¥–æ–ø–æ–º–æ–≥—É

https://github.com/filiptibell/async-language-server
